{
    "version": "2.0.0",
    "tasks": [
        {
            "type": "shell",
            "label": "Flash with OpenOCD (Linux)",
            "command": "openocd",
            "args": [
                "-f", "interface/stlink.cfg",
                "-f", "target/stm32f1x.cfg",
                "-c", "program build/${command:cmake.buildType}/Leany.elf verify reset exit"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Display symbols size",
            "command": "arm-none-eabi-nm",
            "args": [
                "--print-size",
                "--size-sort",
                "--reverse-sort",
                "--format=sysv",
                "--radix=d",
                "Leany.elf"
            ],
            "options": {
                "cwd": "${command:cmake.buildDirectory}"
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Run clang-tidy",
            "windows": {
                "command": "python.exe",
                "args": [
                    "C:/msys64/ucrt64/bin/run-clang-tidy",
                    "-quiet",
                    "-p${command:cmake.buildDirectory}",
                    "-extra-arg=--sysroot=C:/msys64/ucrt64/arm-none-eabi",
                    "(hardware^|ui^|dispatcher)"
                ],
                "options": {
                    "shell": {
                        "executable": "cmd.exe",
                        "args": [
                            "/d",
                            "/c"
                        ]
                    }
                }
            },
            "linux": {
                "command": "run-clang-tidy",
                "args": [
                    "-quiet",
                    "-p${command:cmake.buildDirectory}",
                    "-extra-arg=--sysroot=/opt/arm-none-eabi/arm-none-eabi/",
                    "\"(hardware|ui|dispatcher)\""
                ]
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Run clang-format validation",
            "windows": {
                "command": "Get-ChildItem -Path hardware,ui,dispatcher -Recurse -Include *.c,*.h -File | ForEach-Object {clang-format --style=file --dry-run --Werror --verbose $_.FullName }"
            },
            "linux": {
                "command": "find hardware ui dispatcher -name '*.c' -o -name '*.h' | xargs clang-format --style=file --dry-run --Werror --verbose"
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Run Doxygen",
            "command": "doxygen",
            "args": [
                "firmware/Doxyfile"
            ],
            "options": {
                "cwd": "${workspaceFolder}/.."
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Create the CppCheck output directory",
            "hide": true,
            "command": "mkdir",
            "windows":{
                "args": [
                    "-Force",
                    "config-cppcheck-build-dir"
                ]
            },
            "linux":{
                "args": [
                    "-p",
                    "config-cppcheck-build-dir"
                ],
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Run CppCheck",
            "dependsOn": [
                "Create the CppCheck output directory"
            ],
            "command": "cppcheck",
            "args": [
                "--enable=all",
                "--language=c",
                "--inconclusive",
                "--inline-suppr",
                "--error-exitcode=2",
                "--project=${command:cmake.launchTargetDirectory}/compile_commands.json",
                "--cppcheck-build-dir=config-cppcheck-build-dir/",
                "--check-level=exhaustive",
                "-ibuild/",
                "-iDrivers/",
                "-iMiddlewares/",
                "-iCore/",
                "--suppress=missingIncludeSystem",
                "--suppress=missingInclude",
                "--suppress=unusedFunction",
                "--suppress=unknownMacro"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Validate copyright and licensing",
            "command": "reuse",
            "args": [
                "--include-submodules",
                "lint"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "type": "shell",
            "label": "Run Lizard",
            "command": "lizard",
            "args": [
                "-Tlength=60",
                "-Tnloc=60",
                "-Tparameter_count=5",
                "-Tcyclomatic_complexity=10",
                "-Eduplicate",
                "-m",
                "hardware/",
                "ui/",
                "dispatcher/"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        }
    ]
}
